<!DOCTYPE profile>
<profile xmlns="http://www.suse.com/1.0/yast2ns" xmlns:config="http://www.suse.com/1.0/configns">
  <add-on>
    <add_on_products config:type="list"/>
  </add-on>
  <bootloader>
    <device_map config:type="list">
      <device_map_entry>
        <firmware>hd0</firmware>
        <linux>/dev/sda</linux>
      </device_map_entry>
    </device_map>
    <global>
      <activate>true</activate>
      <boot_root>true</boot_root>
      <generic_mbr>true</generic_mbr>
      <gfxmenu>/boot/message</gfxmenu>
      <lines_cache_id>2</lines_cache_id>
      <timeout config:type="integer">8</timeout>
    </global>
    <initrd_modules config:type="list">
      <initrd_module>
        <module>megaraid_sas</module>
      </initrd_module>
    </initrd_modules>
    <loader_type>grub</loader_type>
    <sections config:type="list">
      <section>
        <append>resume=/dev/sda1 splash=silent crashkernel=256M-:128M showopts</append>
        <image>/boot/vmlinuz-3.0.76-0.11-default</image>
        <initial>1</initial>
        <initrd>/boot/initrd-3.0.76-0.11-default</initrd>
        <lines_cache_id>0</lines_cache_id>
        <original_name>linux</original_name>
        <root>/dev/sda2</root>
        <type>image</type>
        <vgamode>0x31a</vgamode>
      </section>
      <section>
        <append>showopts ide=nodma apm=off noresume edd=off powersaved=off nohz=off highres=off processor.max_cstate=1 nomodeset x11failsafe</append>
        <image>/boot/vmlinuz-3.0.76-0.11-default</image>
        <initrd>/boot/initrd-3.0.76-0.11-default</initrd>
        <lines_cache_id>1</lines_cache_id>
        <original_name>failsafe</original_name>
        <root>/dev/sda2</root>
        <type>image</type>
        <vgamode>0x31a</vgamode>
      </section>
    </sections>
  </bootloader>
  <ca_mgm>
    <CAName>YaST_Default_CA</CAName>
    <ca_commonName>YaST Default CA (<%= node.hostname %>)</ca_commonName>
    <country>US</country>
    <importCertificate config:type="boolean">false</importCertificate>
    <locality></locality>
    <organisation></organisation>
    <organisationUnit></organisationUnit>
    <password>ENTER PASSWORD HERE</password>
    <server_commonName><%= node.hostname %></server_commonName>
    <server_email>postmaster@site</server_email>
    <state></state>
    <takeLocalServerName config:type="boolean">false</takeLocalServerName>
  </ca_mgm>
  <deploy_image>
    <image_installation config:type="boolean">false</image_installation>
  </deploy_image>
  <firewall>
    <enable_firewall config:type="boolean">true</enable_firewall>
    <start_firewall config:type="boolean">true</start_firewall>
  </firewall>
  <general>
    <ask-list config:type="list"/>
    <mode>
      <confirm config:type="boolean">false</confirm>
      <forceboot config:type="boolean">false</forceboot>
      <final_halt config:type="boolean">false</final_halt>
      <final_reboot config:type="boolean">true</final_reboot>
      <halt config:type="boolean">false</halt>
      <second_stage config:type="boolean">true</second_stage>
    </mode>
    <mouse>
      <id>none</id>
    </mouse>
    <proposals config:type="list"/>
    <signature-handling>
      <accept_file_without_checksum config:type="boolean">true</accept_file_without_checksum>
      <accept_non_trusted_gpg_key config:type="boolean">true</accept_non_trusted_gpg_key>
      <accept_unknown_gpg_key config:type="boolean">true</accept_unknown_gpg_key>
      <accept_unsigned_file config:type="boolean">true</accept_unsigned_file>
      <accept_verification_failed config:type="boolean">true</accept_verification_failed>
      <import_gpg_key config:type="boolean">true</import_gpg_key>
    </signature-handling>
    <storage/>
  </general>
  <groups config:type="list">
    <group>
      <encrypted config:type="boolean">true</encrypted>
      <gid>100</gid>
      <group_password>x</group_password>
      <groupname>users</groupname>
      <userlist></userlist>
    </group>
    <group>
      <encrypted config:type="boolean">true</encrypted>
      <gid>16</gid>
      <group_password>x</group_password>
      <groupname>dialout</groupname>
      <userlist>admin</userlist>
    </group>
    <group>
      <encrypted config:type="boolean">true</encrypted>
      <gid>33</gid>
      <group_password>x</group_password>
      <groupname>video</groupname>
      <userlist>admin</userlist>
    </group>
  </groups>
  <kdump>
    <add_crash_kernel config:type="boolean">true</add_crash_kernel>
    <crash_kernel>257M-:128M</crash_kernel>
    <general>
      <KDUMPTOOL_FLAGS></KDUMPTOOL_FLAGS>
      <KDUMP_COMMANDLINE></KDUMP_COMMANDLINE>
      <KDUMP_COMMANDLINE_APPEND></KDUMP_COMMANDLINE_APPEND>
      <KDUMP_CONTINUE_ON_ERROR>true</KDUMP_CONTINUE_ON_ERROR>
      <KDUMP_COPY_KERNEL>yes</KDUMP_COPY_KERNEL>
      <KDUMP_CPUS>1</KDUMP_CPUS>
      <KDUMP_DUMPFORMAT>lzo</KDUMP_DUMPFORMAT>
      <KDUMP_DUMPLEVEL>31</KDUMP_DUMPLEVEL>
      <KDUMP_FREE_DISK_SIZE>64</KDUMP_FREE_DISK_SIZE>
      <KDUMP_HOST_KEY></KDUMP_HOST_KEY>
      <KDUMP_IMMEDIATE_REBOOT>yes</KDUMP_IMMEDIATE_REBOOT>
      <KDUMP_KEEP_OLD_DUMPS>5</KDUMP_KEEP_OLD_DUMPS>
      <KDUMP_KERNELVER></KDUMP_KERNELVER>
      <KDUMP_NETCONFIG>auto</KDUMP_NETCONFIG>
      <KDUMP_NOTIFICATION_CC></KDUMP_NOTIFICATION_CC>
      <KDUMP_NOTIFICATION_TO></KDUMP_NOTIFICATION_TO>
      <KDUMP_POSTSCRIPT></KDUMP_POSTSCRIPT>
      <KDUMP_PRESCRIPT></KDUMP_PRESCRIPT>
      <KDUMP_REQUIRED_PROGRAMS></KDUMP_REQUIRED_PROGRAMS>
      <KDUMP_SAVEDIR>file:///var/crash</KDUMP_SAVEDIR>
      <KDUMP_SMTP_PASSWORD></KDUMP_SMTP_PASSWORD>
      <KDUMP_SMTP_SERVER></KDUMP_SMTP_SERVER>
      <KDUMP_SMTP_USER></KDUMP_SMTP_USER>
      <KDUMP_TRANSFER></KDUMP_TRANSFER>
      <KDUMP_VERBOSE>3</KDUMP_VERBOSE>
      <KEXEC_OPTIONS></KEXEC_OPTIONS>
    </general>
  </kdump>
  <keyboard>
    <keymap>english-us</keymap>
  </keyboard>
  <language>
    <language>en_US</language>
    <languages></languages>
  </language>
  <login_settings/>
<%

   options = node.policy.node_metadata["installer_options"]
   interface = ""
   macaddr = options.to_s
   gateway = ""
   dnsserver = ""
   if options && options["network_configuration"]
     require "json"
     require "asm/network_configuration"

     kernel_opts = {}

     network_config = ASM::NetworkConfiguration.new(JSON.parse(options["network_configuration"]))
     partitions = network_config.get_partitions("PXE","PUBLIC_LAN","PRIVATE_LAN")
     count = 1
     partitions.each do |partition|
       interface = interface + <<-S1
      <interface>
        <bootproto>dhcp</bootproto>
        <device>em#{count}</device>
        <startmode>auto</startmode>
        <usercontrol>no</usercontrol>
      </interface>
S1
       count += 1
     end
   end

%>
  <networking>
    <dhcp_options>
      <dhclient_client_id></dhclient_client_id>
      <dhclient_hostname_option>AUTO</dhclient_hostname_option>
    </dhcp_options>
    <dns>
      <dhcp_hostname config:type="boolean">false</dhcp_hostname>
      <hostname><%= node.hostname unless node.hostname.empty? %></hostname>
      <%= dnsserver unless dnsserver.empty? %>
      <resolv_conf_policy>auto</resolv_conf_policy>
      <write_hostname config:type="boolean">false</write_hostname>
    </dns>
    <interfaces config:type="list">
<%= interface unless interface.empty? %>
      <interface>
        <aliases>
          <alias2>
            <IPADDR>127.0.0.2</IPADDR>
            <NETMASK>255.0.0.0</NETMASK>
            <PREFIXLEN>8</PREFIXLEN>
          </alias2>
        </aliases>
        <broadcast>127.255.255.255</broadcast>
        <device>lo</device>
        <firewall>no</firewall>
        <ipaddr>127.0.0.1</ipaddr>
        <netmask>255.0.0.0</netmask>
        <network>127.0.0.0</network>
        <prefixlen>8</prefixlen>
        <startmode>auto</startmode>
        <usercontrol>no</usercontrol>
      </interface>
    </interfaces>
    <managed config:type="boolean">false</managed>
  </networking>
  <partitioning config:type="list">
    <drive>
      <device>/dev/sda</device>
      <initialize config:type="boolean">true</initialize>
      <use>all</use>
    </drive>
  </partitioning>
  <runlevel>
    <default>3</default>
  </runlevel>
  <security>
#    <console_shutdown>reboot</console_shutdown>
#    <cracklib_dict_path>/usr/lib/cracklib_dict</cracklib_dict_path>
#    <cwd_in_root_path>no</cwd_in_root_path>
#    <cwd_in_user_path>no</cwd_in_user_path>
#    <disable_restart_on_update>no</disable_restart_on_update>
#    <disable_stop_on_removal>no</disable_stop_on_removal>
#    <displaymanager_remote_access>no</displaymanager_remote_access>
#    <displaymanager_root_login_remote>no</displaymanager_root_login_remote>
#    <displaymanager_shutdown>root</displaymanager_shutdown>
#    <displaymanager_xserver_tcp_port_6000_open>no</displaymanager_xserver_tcp_port_6000_open>
#    <enable_sysrq>176</enable_sysrq>
#    <fail_delay>3</fail_delay>
#    <gid_max>60000</gid_max>
#    <gid_min>1000</gid_min>
#    <group_encryption>md5</group_encryption>
#    <ip_forward>no</ip_forward>
#    <ip_tcp_syncookies>yes</ip_tcp_syncookies>
#    <ipv6_forward>no</ipv6_forward>
#    <lastlog_enab>yes</lastlog_enab>
#    <obscure_checks_enab>yes</obscure_checks_enab>
#    <pass_max_days>99999</pass_max_days>
#    <pass_min_days>0</pass_min_days>
#    <pass_min_len>5</pass_min_len>
#    <pass_warn_age>7</pass_warn_age>
    <passwd_encryption>sha512</passwd_encryption>
#    <passwd_remember_history>0</passwd_remember_history>
#    <passwd_use_cracklib>yes</passwd_use_cracklib>
#    <permission_security>easy</permission_security>
#    <run_updatedb_as></run_updatedb_as>
#    <runlevel3_extra_services>insecure</runlevel3_extra_services>
#    <runlevel3_mandatory_services>insecure</runlevel3_mandatory_services>
#    <runlevel5_extra_services>insecure</runlevel5_extra_services>
#    <runlevel5_mandatory_services>insecure</runlevel5_mandatory_services>
#    <smtpd_listen_remote>no</smtpd_listen_remote>
#    <syslog_on_no_error>no</syslog_on_no_error>
#    <system_gid_max>499</system_gid_max>
#    <system_gid_min>100</system_gid_min>
#    <system_uid_max>499</system_uid_max>
#    <system_uid_min>100</system_uid_min>
#    <systohc>yes</systohc>
#    <uid_max>60000</uid_max>
#    <uid_min>1000</uid_min>
#    <useradd_cmd>/usr/sbin/useradd.local</useradd_cmd>
#    <userdel_postcmd>/usr/sbin/userdel-post.local</userdel_postcmd>
#    <userdel_precmd>/usr/sbin/userdel-pre.local</userdel_precmd>
  </security>
  <software>
    <packages config:type="list">
      <package>ConsoleKit-32bit</package>
      <package>Mesa-32bit</package>
      <package>PolicyKit-32bit</package>
      <package>PolicyKit-gnome-libs-32bit</package>
      <package>aspell-32bit</package>
      <package>at-spi-32bit</package>
      <package>audiofile-32bit</package>
      <package>audit-libs-32bit</package>
      <package>bind-libs-32bit</package>
      <package>biosdevname</package>
      <package>cpufrequtils-32bit</package>
      <package>cracklib-32bit</package>
      <package>cryptconfig-32bit</package>
      <package>cyrus-sasl-32bit</package>
      <package>cyrus-sasl-gssapi-32bit</package>
      <package>cyrus-sasl-plain-32bit</package>
      <package>dbus-1-32bit</package>
      <package>dbus-1-glib-32bit</package>
      <package>device-mapper-32bit</package>
      <package>evolution-data-server-32bit</package>
      <package>fam-32bit</package>
      <package>file-32bit</package>
      <package>freeglut-32bit</package>
      <package>freetype-32bit</package>
      <package>fribidi-32bit</package>
      <package>gconf2-32bit</package>
      <package>gdbm-32bit</package>
      <package>gettext-runtime-32bit</package>
      <package>giflib-32bit</package>
      <package>glibc-locale-32bit</package>
      <package>gnome-keyring-32bit</package>
      <package>gnome-panel-32bit</package>
      <package>gnome-vfs2-32bit</package>
      <package>gpm-32bit</package>
      <package>hal-32bit</package>
      <package>hunspell-32bit</package>
      <package>libFLAC8-32bit</package>
      <package>libHX13-32bit</package>
      <package>libacl-32bit</package>
      <package>libaio-32bit</package>
      <package>libart_lgpl-32bit</package>
      <package>libattr-32bit</package>
      <package>libavahi-client3-32bit</package>
      <package>libavahi-common3-32bit</package>
      <package>libavahi-glib1-32bit</package>
      <package>libblkid1-32bit</package>
      <package>libbonobo-32bit</package>
      <package>libbonoboui-32bit</package>
      <package>libbz2-1-32bit</package>
      <package>libcanberra-gtk-32bit</package>
      <package>libcanberra-gtk0-32bit</package>
      <package>libcanberra0-32bit</package>
      <package>libcap2-32bit</package>
      <package>libcroco-0_6-3-32bit</package>
      <package>libcurl4-32bit</package>
      <package>libdb-4_5-32bit</package>
      <package>libdrm-32bit</package>
      <package>libesd0-32bit</package>
      <package>libfreebl3-32bit</package>
      <package>libgcc43-32bit</package>
      <package>libgcc46-32bit</package>
      <package>libgcrypt11-32bit</package>
      <package>libglade2-32bit</package>
      <package>libgnome-32bit</package>
      <package>libgnome-desktop-2-11-32bit</package>
      <package>libgnomecanvas-32bit</package>
      <package>libgnutls26-32bit</package>
      <package>libgpg-error0-32bit</package>
      <package>libgsf-1-114-32bit</package>
      <package>libgstreamer-0_10-0-32bit</package>
      <package>libgthread-2_0-0-32bit</package>
      <package>libgweather1-32bit</package>
      <package>libical0-32bit</package>
      <package>libidl-32bit</package>
      <package>libidn-32bit</package>
      <package>liblcms1-32bit</package>
      <package>libldap-2_4-2-32bit</package>
      <package>libltdl7-32bit</package>
      <package>liblzma5-32bit</package>
      <package>libmng-32bit</package>
      <package>libnetpbm10-32bit</package>
      <package>libnscd-32bit</package>
      <package>libnsssharedhelper0-32bit</package>
      <package>libogg0-32bit</package>
      <package>libopenct1-32bit</package>
      <package>libopensc2-32bit</package>
      <package>libpciaccess0-32bit</package>
      <package>libproxy0-32bit</package>
      <package>libproxy0-config-gnome</package>
      <package>libpulse0-32bit</package>
      <package>libpython2_6-1_0-32bit</package>
      <package>libqt4-32bit</package>
      <package>libqt4-qt3support-32bit</package>
      <package>libqt4-sql-32bit</package>
      <package>libqt4-x11-32bit</package>
      <package>libreiserfs-32bit</package>
      <package>librsvg-32bit</package>
      <package>libsepol1-32bit</package>
      <package>libsmbclient0-32bit</package>
      <package>libsmbios2-32bit</package>
      <package>libsndfile-32bit</package>
      <package>libsoftokn3-32bit</package>
      <package>libsoup-2_4-1-32bit</package>
      <package>libsqlite3-0-32bit</package>
      <package>libstdc++33-32bit</package>
      <package>libstdc++43-32bit</package>
      <package>libstdc++46-32bit</package>
      <package>libtalloc2-32bit</package>
      <package>libtasn1-3-32bit</package>
      <package>libtdb1-32bit</package>
      <package>libtool-32bit</package>
      <package>libudev0-32bit</package>
      <package>libvorbis-32bit</package>
      <package>libwbclient0-32bit</package>
      <package>libwnck-1-22-32bit</package>
      <package>libxcrypt-32bit</package>
      <package>libxml2-32bit</package>
      <package>libxslt-32bit</package>
      <package>mozilla-nspr-32bit</package>
      <package>mozilla-nss-32bit</package>
      <package>mozilla-xulrunner192-32bit</package>
      <package>nautilus-32bit</package>
      <package>nautilus-cd-burner-32bit</package>
      <package>opensc-32bit</package>
      <package>openslp-32bit</package>
      <package>opie-32bit</package>
      <package>orbit2-32bit</package>
      <package>pam-32bit</package>
      <package>pam-modules-32bit</package>
      <package>pam_mount-32bit</package>
      <package>parted-32bit</package>
      <package>pciutils-32bit</package>
      <package>pcsc-lite-32bit</package>
      <package>perl-32bit</package>
      <package>popt-32bit</package>
      <package>qt3-32bit</package>
      <package>rpm-32bit</package>
      <package>samba-32bit</package>
      <package>samba-client-32bit</package>
      <package>startup-notification-32bit</package>
      <package>strace-32bit</package>
      <package>sysfsutils-32bit</package>
      <package>tcl-32bit</package>
      <package>tcpd-32bit</package>
      <package>tk-32bit</package>
      <package>utempter-32bit</package>
      <package>xaw3d-32bit</package>
      <package>xorg-x11-driver-video-radeonhd</package>
      <package>yast2-trans-en_US</package>
    </packages>
    <patterns config:type="list">
      <pattern>Minimal</pattern>
      <pattern>base</pattern>
    </patterns>
    <remove-packages config:type="list">
      <package>puppet-server-2.6.18-0.4.2.x86_64.rpm</package>
    </remove-packages>
  </software>
  <sound>
    <configure_detected config:type="boolean">false</configure_detected>
    <modules_conf config:type="list"/>
    <pulse_audio_status config:type="boolean">false</pulse_audio_status>
    <rc_vars>
      <LOAD_ALSA_SEQ>yes</LOAD_ALSA_SEQ>
    </rc_vars>
    <volume_settings config:type="list"/>
  </sound>
  <suse_register>
    <do_registration config:type="boolean">false</do_registration>
    <reg_server></reg_server>
    <reg_server_cert></reg_server_cert>
    <register_regularly config:type="boolean">false</register_regularly>
    <registration_data/>
    <submit_hwdata config:type="boolean">false</submit_hwdata>
    <submit_optional config:type="boolean">false</submit_optional>
  </suse_register>
  <timezone>
    <hwclock>UTC</hwclock>
    <timezone><%=
    options = node.policy.node_metadata['installer_options'] || {}
    (options['time_zone'] || '').strip.size > 0 ? "#{options['time_zone']}" : 'America/Los_Angeles'
%></timezone>
  </timezone>
  <user_defaults>
    <expire></expire>
    <group>100</group>
    <groups>video,dialout</groups>
    <home>/home</home>
    <inactive>-1</inactive>
    <shell>/bin/bash</shell>
    <skel>/etc/skel</skel>
    <umask>022</umask>
  </user_defaults>
  <users config:type="list">
    <user>
      <username>root</username>
      <user_password><%=
    require 'asm/cipher'
    require 'unix_crypt'
    asm_decrypted_password = ASM::Cipher.decrypt_string(node.root_password)
    UnixCrypt::SHA512.build(asm_decrypted_password)
%></user_password>
      <encrypted config:type="boolean">true</encrypted>
      <forename/>
      <surname/>
     </user>
  </users>
  <ntp-client>
    <configure_dhcp config:type="boolean">false</configure_dhcp>
    <peers config:type="list">
      <peer>
        <address><%=
    options = node.policy.node_metadata['installer_options'] || {}
    (options['ntp_server'] || '').strip.size > 0 ? options['ntp_server'] : ""
%></address>
        <initial_sync config:type="boolean">true</initial_sync>
        <options></options>
        <type>server</type>
      </peer>
    </peers>
    <start_at_boot config:type="boolean">true</start_at_boot>
    <start_in_chroot config:type="boolean">true</start_in_chroot>
  </ntp-client>
  <scripts>
    <chroot-scripts config:type="list">
      <script>
        <source><![CDATA[
curl -s <%= stage_done_url("autoyast") %> 
]]>
        </source>
      </script>
    </chroot-scripts>
    <init-scripts config:type="list">
      <script>
        <filename>checkintest.sh</filename>
        <network_needed>true</network_needed>
        <source><![CDATA[
<%= render_template("post_install") %>
]]>
        </source>
      </script>
      <script>
        <filename>ntpsetup.sh</filename>
        <rerun config:type="boolean">true</rerun>
        <source><![CDATA[
        #!/bin/bash
exec >> /var/log/razor.log 2>&1

echo "Starting post_install2"
#ensure ntp is running
/etc/init.d/ntp start
chkconfig puppet on
service puppet start
puppet agent -t
]]>
        </source>
      </script>
    </init-scripts>
  </scripts>
</profile>
